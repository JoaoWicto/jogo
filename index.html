<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Terror Survival</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
    margin:0;
    padding:0;
    background:#111;
    overflow:hidden;
    font-family:monospace;
}
canvas{display:block}

button{
    background:#111;
    border:1px solid red;
    color:#fff;
    padding:8px 16px;
    cursor:pointer;
}
button:hover{background:red}

#hud{
    position:fixed;
    top:10px;
    left:10px;
    background:rgba(0,0,0,.7);
    border:1px solid red;
    padding:10px;
    color:#fff;
    z-index:5;
    font-size:14px;
}

.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.9);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:15px;
    color:red;
    z-index:20;
}
.hidden{display:none}

#mobileControls{
    position:fixed;
    bottom:10px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    z-index:15;
}
.mobile-btn{
    width:50px;
    height:50px;
    font-size:18px;
    border:1px solid red;
    background:#111;
    color:#fff;
    border-radius:8px;
}
.mobile-btn:hover{background:red}

#powerBar{
    width:150px;
    height:10px;
    background:#222;
    border:1px solid red;
    margin-top:5px;
}
#powerFill{
    width:0%;
    height:100%;
    background:orange;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<!-- MENU -->
<div id="menu" class="overlay">
    <h1>TERROR SURVIVAL</h1>
    <button onclick="startGame()">‚ñ∂ JOGAR</button>
</div>

<!-- UPGRADE -->
<div id="upgrade" class="overlay hidden">
    <h2>ESCOLHA UM B√îNUS</h2>
    <button onclick="upgradeLife()">‚ù§Ô∏è +5% VIDA</button>
    <button onclick="upgradeAttack()">‚öîÔ∏è +5% ATAQUE</button>
</div>

<!-- SHOP -->
<div id="shop" class="overlay hidden">
    <h2>üõí LOJA</h2>
    <button onclick="buySpeed()">‚ö° Velocidade (20s) - 10 moedas</button>
    <button onclick="freezeEnemies()">‚ùÑÔ∏è Congelar inimigos (5s) - 15 moedas</button>
    <button onclick="upgradePowerRegen()">‚ö° Recarga Poder</button>
    <button onclick="changeColor()">üé® Cor do Player</button>
    <button onclick="toggleShop()">‚ùå FECHAR</button>
</div>

<!-- GAME OVER -->
<div id="gameover" class="overlay hidden">
    <h1>GAME OVER</h1>
    <p id="finalScore"></p>
    <button onclick="restartGame()">üîÑ REINICIAR</button>
</div>

<!-- HUD -->
<div id="hud">
VIDA: <span id="hudLife"></span><br>
PONTOS: <span id="hudScore"></span><br>
MOEDAS: <span id="hudCoins"></span><br>
MORTES: <span id="hudKills"></span><br>
BUFF: <span id="hudBuff">Nenhum</span><br>
HABILIDADE: <span id="hudSkill">Nenhuma</span><br>
<div id="powerBar"><div id="powerFill"></div></div><br>
<button onclick="toggleShop()">üõí LOJA</button>
</div>

<!-- MOBILE CONTROLS -->
<div id="mobileControls">
    <button class="mobile-btn" id="btnUp">‚ñ≤</button>
    <button class="mobile-btn" id="btnLeft">‚óÄ</button>
    <button class="mobile-btn" id="btnDown">‚ñº</button>
    <button class="mobile-btn" id="btnRight">‚ñ∂</button>
    <button class="mobile-btn" id="skill1">1</button>
    <button class="mobile-btn" id="skill2">2</button>
    <button class="mobile-btn" id="skill3">3</button>
    <button class="mobile-btn" id="skill4">4</button>
    <button class="mobile-btn" id="skill5">5</button>
    <button class="mobile-btn" id="skill6">6</button>
    <button class="mobile-btn" id="skill7">7</button>
    <button class="mobile-btn" id="skill8">8</button>
    <button class="mobile-btn" id="skill9">9</button>
    <button class="mobile-btn" id="skill10">0</button>
</div>

<script>
// ================= CANVAS =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
addEventListener("resize",resize);resize();

// ================= ELEMENTOS =================
const menu=document.getElementById("menu");
const upgrade=document.getElementById("upgrade");
const shop=document.getElementById("shop");
const gameoverScreen=document.getElementById("gameover");

const hudLife=document.getElementById("hudLife");
const hudScore=document.getElementById("hudScore");
const hudCoins=document.getElementById("hudCoins");
const hudKills=document.getElementById("hudKills");
const hudBuff=document.getElementById("hudBuff");
const hudSkill=document.getElementById("hudSkill");
const finalScore=document.getElementById("finalScore");
const powerFill=document.getElementById("powerFill");

// ================= STATE =================
let state="menu"; // menu | playing | upgrade | gameover
let shopOpen=false;

// ================= PLAYER =================
const player={
    x:0,y:0,
    size:18,
    speed:3,baseSpeed:3,
    life:100,maxLife:100,
    attackRange:50,
    inv:0,atk:0,cd:0,
    effect:null,
    effectTimer:0
};

// ================= GAME VARS =================
let score=0, coins=0, kills=0;
let nextUpgrade=5;
let enemyCount=1;
let power=0, powerMax=100;
let powerRegenRate=1000; // 1 por segundo
let speedTimer=0;
let freezeTimer=0;

// ================= ENEMIES =================
const enemies=[];
const LIGHT=180;

// ================= INPUT =================
const keys={};
addEventListener("keydown",e=>{
    keys[e.key.toLowerCase()]=true;
    if("1234567890".includes(e.key))useLegendarySkill(parseInt(e.key)-1);
    if(e.code==="Space")attack();
    if(e.key==="√ß"||e.key==="√á")toggleShop();
});
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

// ================= MOBILE CONTROLS =================
const mobileKeys={up:false,down:false,left:false,right:false};
document.getElementById("btnUp").addEventListener("touchstart",()=>mobileKeys.up=true);
document.getElementById("btnUp").addEventListener("touchend",()=>mobileKeys.up=false);
document.getElementById("btnDown").addEventListener("touchstart",()=>mobileKeys.down=true);
document.getElementById("btnDown").addEventListener("touchend",()=>mobileKeys.down=false);
document.getElementById("btnLeft").addEventListener("touchstart",()=>mobileKeys.left=true);
document.getElementById("btnLeft").addEventListener("touchend",()=>mobileKeys.left=false);
document.getElementById("btnRight").addEventListener("touchstart",()=>mobileKeys.right=true);
document.getElementById("btnRight").addEventListener("touchend",()=>mobileKeys.right=false);
for(let i=0;i<10;i++){
  document.getElementById(`skill${i+1}`).addEventListener("touchstart",()=>useLegendarySkill(i));
}

// ================= HABILIDADES LEND√ÅRIAS =================
const legendarySkills=[
  {name:"Tempestade de Fogo", cost:50, effect:"orange", func:()=>{enemies.forEach(e=>e.life-=50);player.speed+=0.5;}},
  {name:"Corte Rel√¢mpago", cost:60, effect:"yellow", func:()=>{enemies.forEach(e=>{if(Math.hypot(player.x-e.x,player.y-e.y)<player.attackRange*2)e.life-=70;});}},
  {name:"Congelamento Global", cost:70, effect:"cyan", func:()=>{enemies.forEach(e=>e.freeze=180);}},
  {name:"Explos√£o de Energia", cost:80, effect:"magenta", func:()=>{enemies.forEach(e=>e.life-=100);player.effectTimer=60;}},
  {name:"F√∫ria do Drag√£o", cost:90, effect:"red", func:()=>{player.attackRange*=1.5;}},
  {name:"Aura de Cura", cost:60, effect:"green", func:()=>{player.life+=player.maxLife*0.3;if(player.life>player.maxLife)player.life=player.maxLife;}},
  {name:"Chuva de Flechas", cost:40, effect:"brown", func:()=>{enemies.forEach(e=>{if(Math.random()<0.5)e.life-=30;});}},
  {name:"Escudo de Luz", cost:50, effect:"white", func:()=>{player.inv=120;}},
  {name:"V√≥rtice Negro", cost:70, effect:"black", func:()=>{enemies.forEach(e=>{let dx=player.x-e.x,dy=player.y-e.y,d=Math.hypot(dx,dy);e.x+=dx/d*5;e.y+=dy/d*5;});}},
  {name:"Dom√≠nio Elemental", cost:100, effect:"purple", func:()=>{player.attackRange*=2;powerRegenRate*=0.5;}}
];

function useLegendarySkill(index){
  if(state!=="playing")return;
  const skill=legendarySkills[index];
  if(power>=skill.cost){
    power-=skill.cost;
    player.effect=skill.effect;
    player.effectTimer=60;
    skill.func();
    hudSkill.textContent=skill.name;
    hudBuff.textContent=skill.name;
  }
}

// ================= FLOW =================
function startGame(){
    resetGame();
    menu.classList.add("hidden");
    state="playing";
}

function restartGame(){
    gameoverScreen.classList.add("hidden");
    startGame();
}

function resetGame(){
    score=coins=kills=0;
    nextUpgrade=5;
    enemyCount=1;

    player.x=canvas.width/2;
    player.y=canvas.height/2;
    player.life=player.maxLife=100;
    player.attackRange=50;
    player.speed=player.baseSpeed;

    spawnEnemies();
}

// ================= SHOP =================
function toggleShop(){
    if(state!=="playing")return;
    shopOpen=!shopOpen;
    shop.classList.toggle("hidden");
}

function buySpeed(){
    if(coins>=10 && speedTimer<=0){
        coins-=10;
        speedTimer=1200;
        player.speed=5;
    }
}

function freezeEnemies(){
    if(coins>=15 && freezeTimer<=0){
        coins-=15;
        freezeTimer=300;
    }
}

let powerRegenCost=20;
function upgradePowerRegen(){
    if(coins>=powerRegenCost && powerRegenRate>400){
        coins-=powerRegenCost;
        powerRegenRate-=100;
        powerRegenCost+=5;
    }
}

function changeColor(){
    if(coins>=10){
        coins-=10;
        player.color=`hsl(${Math.random()*360},80%,60%)`;
    }
}

// ================= UPGRADES =================
function checkUpgrade(){
    if(kills>=nextUpgrade){
        state="upgrade";
        upgrade.classList.remove("hidden");
    }
}

function upgradeLife(){
    player.maxLife*=1.05;
    player.life=player.maxLife;
    closeUpgrade();
}

function upgradeAttack(){
    player.attackRange*=1.05;
    closeUpgrade();
}

function closeUpgrade(){
    upgrade.classList.add("hidden");
    nextUpgrade*=2;
    state="playing";
}

// ================= ENEMIES =================
function spawnEnemies(){
    enemies.length=0;
    for(let i=0;i<enemyCount;i++){
        const r=Math.random();
        let type="normal";

        if(r<0.3) type="runner";
        else if(r<0.5) type="tank";
        else if(r<0.65) type="ghost";

        let e={type,x:Math.random()*canvas.width,y:Math.random()*canvas.height};

        if(type==="runner"){
            Object.assign(e,{size:12,speed:2.4,life:20,reward:2});
        }else if(type==="tank"){
            Object.assign(e,{size:24,speed:0.8,life:50,reward:5});
        }else if(type==="ghost"){
            Object.assign(e,{size:18,speed:1.5,life:40,reward:3,phase:0});
        }else{
            Object.assign(e,{size:16,speed:1.2,life:40,reward:2});
        }
        enemies.push(e);
    }
}

// ================= ATTACK =================
function attack(){
    if(player.cd>0||state!=="playing"||shopOpen)return;
    player.atk=10;player.cd=30;

    enemies.forEach((e,i)=>{
        if(Math.hypot(player.x-e.x,player.y-e.y)<player.attackRange){
            e.life-=20;
            if(e.life<=0){
                enemies.splice(i,1);
                kills++;
                coins+=e.reward;
                score+=e.reward*100;
                checkUpgrade();
            }
        }
    });

    if(enemies.length===0)spawnEnemies();
}

// ================= UPDATE =================
function update(){
    if(state!=="playing"||shopOpen)return;

    if(speedTimer>0) speedTimer--;
    else player.speed=player.baseSpeed;

    if(freezeTimer>0) freezeTimer--;

    if(keys.w)player.y-=player.speed;
    if(keys.s)player.y+=player.speed;
    if(keys.a)player.x-=player.speed;
    if(keys.d)player.x+=player.speed;

    // mobile input
    if(mobileKeys.up)player.y-=player.speed;
    if(mobileKeys.down)player.y+=player.speed;
    if(mobileKeys.left)player.x-=player.speed;
    if(mobileKeys.right)player.x+=player.speed;

    player.x=Math.max(player.size,Math.min(canvas.width-player.size,player.x));
    player.y=Math.max(player.size,Math.min(canvas.height-player.size,player.y));

    // inimigos
    enemies.forEach(e=>{
        if(freezeTimer>0)return;

        let dx=player.x-e.x,dy=player.y-e.y;
        let d=Math.hypot(dx,dy);

        if(e.type==="ghost"){
            e.phase+=0.05;
            e.x+=Math.cos(e.phase)*2;
            e.y+=Math.sin(e.phase)*2;
        }

        if(d>0){
            e.x+=(dx/d)*e.speed;
            e.y+=(dy/d)*e.speed;
        }

        if(d<player.size+e.size && player.inv<=0){
            player.life-=20;
            player.inv=60;
            if(player.life<=0){
                state="gameover";
                gameoverScreen.classList.remove("hidden");
                finalScore.textContent="PONTOS: "+score;
            }
        }
    });

    if(player.inv>0)player.inv--;
    if(player.atk>0)player.atk--;
    if(player.cd>0)player.cd--;

    score++;

    const extra=Math.floor(score/5000)*2;
    if(enemyCount!==1+extra){
        enemyCount=1+extra;
        spawnEnemies();
    }

    // regenerar poder
    if(power<powerMax && performance.now()%powerRegenRate<16) power++;

    if(player.effectTimer>0) player.effectTimer--;
    else player.effect=null;
}

// ================= DRAW =================
function draw(){
    ctx.fillStyle="#0a0a0a";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // efeito de luz
    ctx.save();
    const g=ctx.createRadialGradient(player.x,player.y,0,player.x,player.y,LIGHT);
    g.addColorStop(0,"rgba(255,255,200,.9)");
    g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.globalCompositeOperation="lighter";
    ctx.fillStyle=g;
    ctx.beginPath();
    ctx.arc(player.x,player.y,LIGHT,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    // player
    ctx.fillStyle=player.effect?player.effect:"#fff";
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
    ctx.fill();

    // ataque range
    if(player.atk>0){
        ctx.strokeStyle="yellow";
        ctx.beginPath();
        ctx.arc(player.x,player.y,player.attackRange,0,Math.PI*2);
        ctx.stroke();
    }

    // inimigos
    enemies.forEach(e=>{
        if(Math.hypot(player.x-e.x,player.y-e.y)<LIGHT){
            if(e.type==="runner")ctx.fillStyle="#ff4444";
            else if(e.type==="tank")ctx.fillStyle="#880000";
            else if(e.type==="ghost")ctx.fillStyle="#ffffff";
            else ctx.fillStyle="red";

            ctx.beginPath();
            ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
            ctx.fill();
        }
    });

    // HUD
    hudLife.textContent=Math.floor(player.life);
    hudScore.textContent=score;
    hudCoins.textContent=coins;
    hudKills.textContent=kills;
    hudBuff.textContent=
        speedTimer>0?"Velocidade "+Math.ceil(speedTimer/60)+"s":
        freezeTimer>0?"Congelamento "+Math.ceil(freezeTimer/60)+"s":
        "Nenhum";

    hudSkill.textContent=player.effect?player.effect:"Nenhuma";

    powerFill.style.width=(power/powerMax*100)+"%";
}

// ================= LOOP =================
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
