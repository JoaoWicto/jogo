<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Terror Survival</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{
    margin:0;
    padding:0;
    background:#111;
    overflow:hidden;
    font-family:monospace;
    touch-action: none; /* evita scroll por toque */
}
canvas{display:block; width:100%; height:100%;}

button{
    background:#111;
    border:1px solid red;
    color:#fff;
    padding:8px 16px;
    cursor:pointer;
    touch-action: manipulation;
}
button:hover{background:red}

#hud{
    position:fixed;
    top:10px;
    left:10px;
    background:rgba(0,0,0,.7);
    border:1px solid red;
    padding:10px;
    color:#fff;
    z-index:5;
    font-size:14px;
    max-width:90%;
}

.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.9);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:10px;
    color:red;
    z-index:20;
    padding:10px;
}
.hidden{display:none}

#mobileControls{
    position:fixed;
    bottom:10px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    z-index:15;
    justify-content:center;
}
.mobile-btn{
    width:50px;
    height:50px;
    font-size:18px;
    border:1px solid red;
    background:#111;
    color:#fff;
    border-radius:8px;
    user-select:none;
}
.mobile-btn:hover{background:red}

#powerBar{
    width:150px;
    height:10px;
    background:#222;
    border:1px solid red;
    margin-top:5px;
}
#powerFill{
    width:0%;
    height:100%;
    background:orange;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<!-- MENU -->
<div id="menu" class="overlay">
    <h1>TERROR SURVIVAL</h1>
    <button onclick="startGame()">‚ñ∂ JOGAR</button>
</div>

<!-- UPGRADE -->
<div id="upgrade" class="overlay hidden">
    <h2>ESCOLHA UM B√îNUS</h2>
    <button onclick="upgradeLife()">‚ù§Ô∏è +5% VIDA</button>
    <button onclick="upgradeAttack()">‚öîÔ∏è +5% ATAQUE</button>
</div>

<!-- SHOP -->
<div id="shop" class="overlay hidden">
    <h2>üõí LOJA</h2>
    <button onclick="buySpeed()">‚ö° Velocidade (20s) - 10 moedas</button>
    <button onclick="freezeEnemies()">‚ùÑÔ∏è Congelar inimigos (5s) - 15 moedas</button>
    <button onclick="upgradePowerRegen()">‚ö° Recarga Poder</button>
    <button onclick="changeColor()">üé® Cor do Player</button>
    <button onclick="toggleShop()">‚ùå FECHAR</button>
</div>

<!-- GAME OVER -->
<div id="gameover" class="overlay hidden">
    <h1>GAME OVER</h1>
    <p id="finalScore"></p>
    <button onclick="restartGame()">üîÑ REINICIAR</button>
</div>

<!-- HUD -->
<div id="hud">
VIDA: <span id="hudLife"></span><br>
PONTOS: <span id="hudScore"></span><br>
MOEDAS: <span id="hudCoins"></span><br>
MORTES: <span id="hudKills"></span><br>
BUFF: <span id="hudBuff">Nenhum</span><br>
HABILIDADE: <span id="hudSkill">Nenhuma</span><br>
<div id="powerBar"><div id="powerFill"></div></div><br>
<button onclick="toggleShop()">üõí LOJA</button>
</div>

<!-- MOBILE CONTROLS -->
<div id="mobileControls">
    <button class="mobile-btn" id="btnUp">‚ñ≤</button>
    <button class="mobile-btn" id="btnLeft">‚óÄ</button>
    <button class="mobile-btn" id="btnDown">‚ñº</button>
    <button class="mobile-btn" id="btnRight">‚ñ∂</button>
    <button class="mobile-btn" id="skill1">1</button>
    <button class="mobile-btn" id="skill2">2</button>
    <button class="mobile-btn" id="skill3">3</button>
    <button class="mobile-btn" id="skill4">4</button>
    <button class="mobile-btn" id="skill5">5</button>
    <button class="mobile-btn" id="skill6">6</button>
    <button class="mobile-btn" id="skill7">7</button>
    <button class="mobile-btn" id="skill8">8</button>
    <button class="mobile-btn" id="skill9">9</button>
    <button class="mobile-btn" id="skill10">0</button>
</div>

<script>
// ================= CANVAS =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;}
window.addEventListener("resize", resize);
resize();

// ================= ELEMENTOS =================
const menu=document.getElementById("menu");
const upgrade=document.getElementById("upgrade");
const shop=document.getElementById("shop");
const gameoverScreen=document.getElementById("gameover");
const hudLife=document.getElementById("hudLife");
const hudScore=document.getElementById("hudScore");
const hudCoins=document.getElementById("hudCoins");
const hudKills=document.getElementById("hudKills");
const hudBuff=document.getElementById("hudBuff");
const hudSkill=document.getElementById("hudSkill");
const finalScore=document.getElementById("finalScore");
const powerFill=document.getElementById("powerFill");

// ================= STATE =================
let state="menu"; 
let shopOpen=false;

// ================= PLAYER =================
const player={x:0,y:0,size:18,speed:3,baseSpeed:3,life:100,maxLife:100,attackRange:50,inv:0,atk:0,cd:0,effect:null,effectTimer:0,color:"#fff"};

// ================= GAME VARS =================
let score=0, coins=0, kills=0, nextUpgrade=5, enemyCount=1, power=0, powerMax=100, powerRegenRate=1000, speedTimer=0, freezeTimer=0;

// ================= ENEMIES =================
const enemies=[];
const LIGHT=180;

// ================= INPUT =================
const keys={};
window.addEventListener("keydown", e=>{
    keys[e.key.toLowerCase()]=true;
    if("1234567890".includes(e.key)) useLegendarySkill(parseInt(e.key)-1);
    if(e.code==="Space") attack();
    if(e.key==="√ß"||e.key==="√á") toggleShop();
});
window.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

// ================= MOBILE CONTROLS =================
const mobileKeys={up:false,down:false,left:false,right:false};
["Up","Down","Left","Right"].forEach((dir,i)=>{
    const btn=document.getElementById("btn"+dir);
    btn.addEventListener("touchstart", ()=> mobileKeys[dir.toLowerCase()]=true);
    btn.addEventListener("touchend", ()=> mobileKeys[dir.toLowerCase()]=false);
});
for(let i=0;i<10;i++){
    const btn=document.getElementById(`skill${i+1}`);
    btn.addEventListener("touchstart", ()=> useLegendarySkill(i));
}

// ================= HABILIDADES =================
const legendarySkills=[/*mesmo array do seu c√≥digo anterior*/];
function useLegendarySkill(index){
    if(state!=="playing")return;
    const skill=legendarySkills[index];
    if(power>=skill.cost){
        power-=skill.cost;
        player.effect=skill.effect;
        player.effectTimer=60;
        skill.func();
        hudSkill.textContent=skill.name;
        hudBuff.textContent=skill.name;
    }
}

// ================= FLOW =================
function startGame(){ resetGame(); menu.classList.add("hidden"); state="playing";}
function restartGame(){ gameoverScreen.classList.add("hidden"); startGame();}
function resetGame(){ 
    score=coins=kills=0; nextUpgrade=5; enemyCount=1;
    player.x=canvas.width/2; player.y=canvas.height/2; 
    player.life=player.maxLife=100; player.attackRange=50; player.speed=player.baseSpeed;
    spawnEnemies();
}

// ================= SHOP =================
function toggleShop(){ if(state!=="playing")return; shopOpen=!shopOpen; shop.classList.toggle("hidden");}
function buySpeed(){ if(coins>=10 && speedTimer<=0){ coins-=10; speedTimer=1200; player.speed=5; } }
function freezeEnemies(){ if(coins>=15 && freezeTimer<=0){ coins-=15; freezeTimer=300; } }
let powerRegenCost=20; function upgradePowerRegen(){ if(coins>=powerRegenCost && powerRegenRate>400){ coins-=powerRegenCost; powerRegenRate-=100; powerRegenCost+=5; } }
function changeColor(){ if(coins>=10){ coins-=10; player.color=`hsl(${Math.random()*360},80%,60%)`; }}

// ================= UPGRADES =================
function checkUpgrade(){ if(kills>=nextUpgrade){ state="upgrade"; upgrade.classList.remove("hidden"); } }
function upgradeLife(){ player.maxLife*=1.05; player.life=player.maxLife; closeUpgrade();}
function upgradeAttack(){ player.attackRange*=1.05; closeUpgrade();}
function closeUpgrade(){ upgrade.classList.add("hidden"); nextUpgrade*=2; state="playing";}

// ================= ENEMIES =================
function spawnEnemies(){ enemies.length=0; for(let i=0;i<enemyCount;i++){ /*mesmo que seu c√≥digo anterior*/ } }

// ================= ATTACK =================
function attack(){ /*mesmo que seu c√≥digo anterior*/ }

// ================= UPDATE =================
function update(){
    if(state!=="playing"||shopOpen)return;
    if(speedTimer>0) speedTimer--; else player.speed=player.baseSpeed;
    if(freezeTimer>0) freezeTimer--;

    // movimento teclado e mobile
    if(keys.w||mobileKeys.up) player.y-=player.speed;
    if(keys.s||mobileKeys.down) player.y+=player.speed;
    if(keys.a||mobileKeys.left) player.x-=player.speed;
    if(keys.d||mobileKeys.right) player.x+=player.speed;

    player.x=Math.max(player.size,Math.min(canvas.width-player.size,player.x));
    player.y=Math.max(player.size,Math.min(canvas.height-player.size,player.y));

    // inimigos
    enemies.forEach(e=>{ /*mesmo c√≥digo anterior de movimenta√ß√£o e ataque*/ });

    if(player.inv>0)player.inv--;
    if(player.atk>0)player.atk--;
    if(player.cd>0)player.cd--;

    score++;
    const extra=Math.floor(score/5000)*2;
    if(enemyCount!==1+extra){ enemyCount=1+extra; spawnEnemies(); }

    if(power<powerMax && performance.now()%powerRegenRate<16) power++;
    if(player.effectTimer>0) player.effectTimer--; else player.effect=null;
}

// ================= DRAW =================
function draw(){ /*mesmo c√≥digo anterior com ctx e HUD*/ }

// ================= LOOP =================
function loop(){ update(); draw(); requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
